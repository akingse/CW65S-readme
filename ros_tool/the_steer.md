## 舵机

## 控制器（底板+Arduino核心板）

## **\*一，舵机\***

***\*原理\****

舵机内部有一个基准电路，产生周期为20ms（50Hz），脉宽在500us到2500us之间，将获得的直流偏置电压与电位器的电压比较，获得电压差输出到电机驱动芯片，驱动芯片根据电压差的正负控制电机的正反转。

Arduino是一个支持多个扩展接口的开源硬件平台。

![image-20201214111338487](https://i.loli.net/2020/12/27/aH74XyKACQBsPUm.png)

## **\*二，控制器\***

总线（Bus）是计算机各种功能部件之间传送信息的公共通信干线，它是由导线组成的传输线束， 按照计算机所传输的信息种类，计算机的总线可以划分为数据总线、地址总线和控制总线，分别用来传输数据、数据地址和控制信号。

![image-20201214111442597](https://i.loli.net/2020/12/27/RlH91xQZgEnm7tq.png) 

PWM控制方式是最早航模、车模、船模等模型行业的标准控制方式，一直继承至今。比较老旧传统了，但是价格便宜

串行总线价格会略贵些，但可以反馈信息，例如位置、扭矩、温度、速度、电压、电流、负载；



```
#002P0500T2000!
#001P1780T1000!

\#***\*001\****P***\*0500\****T0100!

\#ID号PpwmTtime!

单个舵机指令，Index 为 3 位，000-254；pwm 为4 位，0500-2500；time 为 4 位，0000-9999，单位毫秒，总共 15 位数据，不足的位数补 0。

{#000P1500T1000!#001P0900T1000!}
```

```
	* @总线设备基本控制指令表：
	*	1.	#000PID!						//读取ID指令
	*	2.	#000PID001!						//设置ID指令
	*	3.	#000PVER!						//读取版本
	*	4.	#000PBD1!						//设置波特率 默认115200  1:9600 , 2:19200 , 3:38400 , 4:57600 , 5:115200 , 6:128000 7:256000  8:1000000
	*	5.	#000PCLE!						//恢复出厂设置包括ID
	* @总线舵机ZServo控制指令表：
	*	1.	#000P1500T1000!					//舵机角度控制
	*	2.	#000PDST!						//停止
	*	3.	#000PDPT!						//暂停
	*	4.	#000PDCT!						//继续
	*	5.	#000PCSD!						//设置当前值为开机值
	*	6.	#000PCSM!						//开机释放扭力
	*	7.	#000PRAD!						//读取角度
	*	8.	#000PULK!						//释力
	*	9.	#000PULR!						//恢复扭力
	*	10.	#000PSCK!						//设置当前值为1500的偏差值
	*	11.	#000PSCK+050!					//把1500+50作为1500的中间值
	*	12.	#000PSCK-050!					//把1500-50作为1500的中间值
	*	13.	#000PMOD!						//读取模式
	*	14.	#000PMOD1!						//设置模式 舵机模式：2 270 逆时针 1：270 顺 4 180 逆时针 3：180 顺    马达模式：6 360 逆时针 5：360 顺圈 8 360 逆时针 7：360 顺时
	*	15.	#000PRTV!						//读取电压和温度
	*	16.	#000PSTB!						//读取保护值
	*	17.	#000PSTB=60!					//设置保护值 默认60 范围25-80
	*	18.	#000PPAAAIBBB!					//设置KP = AAA, KI = BBB
	*	19.	#000PMIN!						//设置最小值
	*	20.	#000PMAX!						//设置最大值
	*	21.	#000PULM! 						//释力 不带阻力
	*	22.	#000PLN!						//RGB灯开启
	*	23.	#000PLF!						//RGB灯关闭
```

2000——270°

uart_send_str((u8 *)"#002P2500T2000!"); 超过2500，该句不执行；

```
#000P1500T1000!
该指令可以叠加同时控制多个舵机。多个指令同时使用时(2 个或 2 个以上叠加)需要在整条指令前后加“{}”
{G0000#000P1602T1000!#001P2500T0000!#002P1500T1000!}

```



```
工作模式
#000PMOD1! :舵机模式,角度最大范围 270 度,方向顺时针
#000PMOD2! :舵机模式,角度最大范围 270 度,方向逆时针
#000PMOD3! :舵机模式,角度最大范围 180 度,方向顺时针
#000PMOD4! :舵机模式,角度最大范围 180 度,方向逆时针
#000PMOD5! :马达模式,角度 360 度,定圈旋转,方向顺时针
#000PMOD6! :马达模式,角度 360 度,定圈旋转,方向逆时针
#000PMOD7! :马达模式,角度 360 度,定时旋转,方向顺时针
#000PMOD8! :马达模式,角度 360 度,定时旋转,方向逆时针

```

马达模式

```
#000P1800T1000! 表示以 300(1800-1500=300)的速度,运行 1000圈后停止
#000P1800T1000! 表示以 300(1800-1500)的速度,运行 1000S后停止

```



```
#000PDPT! 暂停,舵机运行过程中接收此指令,会停止当前
#000PDCT! 配合暂停指令继续操作
#000PDST! 停止在当前位置,之后无法继续执行
```



> Arduino:1.8.13 (Linux), 开发板："Arduino Uno"
> avrdude: stk500_loadaddr(): (a) protocol error, expect=0x14, resp=0x75
>
> avrdude: stk500_paged_load(): (a) protocol error, expect=0x14, resp=0x61
> avrdude: stk500_cmd(): programmer is out of sync
> avr_read(): error reading address 0x0000
>  read operation not supported for memory "flash"
> avrdude: failed to read all of flash memory, rc=-2
> avrdude: stk500_disable(): protocol error, expect=0x14, resp=0x74